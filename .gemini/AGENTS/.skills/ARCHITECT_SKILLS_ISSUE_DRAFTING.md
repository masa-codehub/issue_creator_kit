# スキル: Issue 案の作成 (Issue Drafting)

**承認済みのロードマップと詳細設計書に基づき、実装エージェントが一点の疑念もなく作業を完遂可能な「タスク指示書（Draft Issue）」を構築するプロセスです。プロセスとチェックリストを統合し、品質を構造的に担保します。**

---

## State 1: Planning (準備とスコープ特定)

作業を開始する前に、何を作るべきかを明確にし、コンテキストを完全に把握します。

1.  **ロードマップの解析**:
    - `reqs/roadmap/active/` 内のアクティブなロードマップを読み込み、現在のフェーズと、未着手のタスクリスト（WBS）を特定します。
2.  **インプットの網羅的収集**:
    - 関連する **詳細設計書 (Design Doc)**、**仕様書 (Specs)**、**ADR** を特定し、全て `read_file` します。これらが Draft の記述根拠（Evidence）となります。
3.  **目標宣言と Todo 作成**:
    - 「ADR-XX Phase-Y のタスク T-1 〜 T-N の Draft を作成します」と宣言し、`save_memory` にタスクごとの進捗管理リストを作成します。

---

## State 2: Execution (ドラフト作成と精密監査)

各タスクファイルに対し、以下の 5 ステップを、チェックリストをパスしながら実行します。

### Step 1: テンプレート適用
- `reqs/tasks/template/issue-draft.md` をベースにファイルを作成します。

### Step 2: メタデータの精密充填
ロードマップと整合性を取りながら Frontmatter を埋めます。
- [ ] **[task_id]**: ロードマップの WBS ID と 1 文字の狂いもなく一致しているか？
- [ ] **[depends_on]**: 先行タスクのファイル名が正しくリスト化されているか？
- [ ] **[next_phase_path]**: **フェーズ最終タスク** の場合、次フェーズの Draft パスが正しく設定されているか？

### Step 3: 実装手順の具体化と証拠紐付け (The Core)
詳細設計書を実装指示に変換します。
- [ ] **[コンテキスト]**: 「なぜやるのか」を ADR/Design Doc から具体的に引用しているか？
- [ ] **[入力コンテキスト]**: 実装者が `Input Context` に指定されたファイル以外を 1 つも開かずに実装を完了できるか？（不足はないか？）
- [ ] **[証拠紐付け]**: 手順の各ステップに、詳細設計書の具体的なセクション番号（例: 第 3.2 項）が明記されているか？
- [ ] **[負の制約]**: 「やってはいけないこと」が、AI の暴走（余計なリファクタリング、ライブラリ追加等）を封じ込めるレベルで具体的に書かれているか？

### Step 4: ブランチ戦略の指定
エージェントの権限境界を守るための指定を行います。
- [ ] **[ブランチ]**: 指定されたベースブランチは、先行タスクのマージ先と矛盾していないか？
- [ ] **[マージ禁止]**: フェーズ最終タスクにおいて、DoD が「マージ」ではなく「監査レポート付き PR 作成」になっているか？（マージ作業を目標に含んでいないか？）

### Step 5: 観測可能性の確保 (Self-Correction)
- [ ] **[観測可能性]**: テスト成功/失敗時に「何が起きるか（ログメッセージ、ファイルの状態変化）」を目視確認できる手順が含まれているか？
- [ ] **[TDD Traceability]**: 検証手順に、対応する `Acceptance Criteria ID` が明記されているか？

---

## State 3: Closing (全体整合性監査)

個別のファイル作成後、システム全体としての整合性を最後に一度だけ確認します。

1.  **成果物のバトンリレー確認**:
    - [ ] タスク A の `Artifact`（成果物）が、後続タスク B の `Input Context`（入力）に漏れなく含まれているか？
2.  **依存の鎖の検証**:
    - [ ] 全 Issue の `depends_on` を繋ぎ合わせた時、ロードマップの依存構造と完全一致し、循環参照がないか？
3.  **情報の重複排除**:
    - [ ] 前後の Issue で同じ説明を繰り返さず、共通事項は設計書への参照に集約されているか？

---

## 完了定義 (DoD)
- [ ] 全ての Draft ファイルが `reqs/tasks/drafts/...` に生成されている。
- [ ] 上記全てのチェックリスト項目に対し、具体的な証拠（ファイル名・パス）を脳内で確認し、合格している。
- [ ] 完了報告を行い、ユーザーに内容の確認（および archive への移動判断）を仰いでいる。
