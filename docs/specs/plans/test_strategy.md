## テスト戦略およびユースケース別テスト概要

本ドキュメントは、本プロジェクトにおけるユースケース単位のテスト観点を整理した「恒常的な」テスト設計メモです。  
実装済みのテストや、今後も維持されるべきテスト観点を明示し、テストコードを読む際のガイドとして利用します。

---

### 1. `WorkflowUseCase` のテスト方針

- **目的:** `WorkflowUseCase.run` の振る舞いを、承認結果ごとの分岐と Git 操作の実行有無の観点から検証する。
- **主なテストケース:**
  1. **`test_run_files_processed_and_changes_pushed`** (in `test_workflow.py`)
     - 前提: 承認処理をモックし、`True`（承認あり）を返すようにする。
     - 観点: 期待される Git 操作（コミットやプッシュなど）が呼び出されることを検証する。
  2. **`test_run_no_files_processed`** (in `test_workflow.py`)
     - 前提: 承認処理をモックし、`False`（変更なし／承認不要）を返すようにする。
     - 観点: Git 操作が呼び出されないことを検証する（不要な書き込みが発生しないこと）。
  3. **`test_run_error_propagates`** (in `test_workflow.py`)
     - 前提: 承認処理が例外を送出するようにモックする。
     - 観点: 例外が適切に伝播し、握りつぶされないことを検証する。

---

### 2. `ApprovalUseCase` のテスト方針

- **目的:** `ApprovalUseCase.process_single_file` および `ApprovalUseCase.process_all_files` の処理フローとロールバック挙動を検証する。
- **主なテストケース:** (in `test_usecase_approval.py`)
  1. **`test_process_single_file_success`**
     - 前提: ファイルシステムと GitHub API をモックする。
     - 観点:
       - 対象ファイルの更新
       - ファイル移動（例: 一時ディレクトリ → 確定ディレクトリ）
       - Issue 作成  
         が期待される順序で実行されることを検証する。
  2. **`test_process_single_file_rollback` / `rollback_failure`**
     - 前提: Issue 作成処理のみ失敗するようにモックし、それ以外は成功させる。
     - 観点: Issue 作成に失敗した場合に、ファイル移動などの副作用がロールバックされることを検証する。
  3. **`test_process_all_files`**
     - 前提: 複数ファイルを処理対象として与える。`process_single_file` はモック可能。
     - 観点:
       - 全ファイルが順に処理されること
       - 戻り値が仕様どおり（例: 成功件数や結果リストなど）であること  
         を確認する。

---

### 3. 注意事項・前提条件

- 対象となるユースケースのコードはすでに存在しているため、最初からテストが Green になる場合があります。
  - これは「テスト観点を明文化し、回帰テストとして維持する」ことが主目的であるため、問題ありません。
- 新たなユースケースや分岐が追加された場合は、本ドキュメントにテスト観点を追記し、テストコードとドキュメントを同期させてください。

---

### 4. コードレビュー時のチェック観点（参考）

- 対象ユースケースに対応するテストが存在するか。
- エラー系（例外発生時）の挙動がテストでカバーされているか。
- 外部サービスや I/O をモックしており、副作用の有無を適切に検証しているか。
- テスト名・テストケースの説明が、このドキュメントと矛盾していないか。
