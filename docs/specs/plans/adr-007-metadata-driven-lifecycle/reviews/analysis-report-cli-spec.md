# Analysis Report - CLI Specification Update (ADR-007)

## 1. 意図の深掘り (Analyze Intent)
- **核心的課題**: 物理ディレクトリ階層に依存していた旧来の CLI 仕様が、ADR-007 のメタデータ駆動・フラット構造と乖離しており、自動化プロセスの誤動作や認知負荷を招いている。
- **期待される成果**: ユーザーやAIエージェントが、特定の ADR に紐づくタスクを、物理パスを意識せずに操作できる CLI インターフェースの確立。

## 2. ギャップ分析 (Gap Analysis)
- **ディレクトリ構造の不一致**: 現状の Spec では `archive/` だが、ADR-007 では `_archive/`。
- **検索ロジックの不在**: これまでは特定のディレクトリ（Virtual Queue）を監視していたが、ADR-007 では `reqs/tasks/<ADR-ID>/` というネストした構造を走査する必要がある。
- **フィルタリング機能の欠如**: 大量のタスクの中から特定の ADR に関連するものだけを処理する手段が Spec 上に存在しない。

## 3. 仮説の立案 (Formulate Hypotheses)

### 3.1. 実証的仮説 (Grounded) - 本命案
- **アプローチ**: `cli_commands.md` のデフォルト値を ADR-007 準拠に修正し、`--adr-id` オプションを追加する。
- **メリット**: 変更が最小限で、既存の `cli.py` の構造を維持しつつ、ADR-007 の要件を満たせる。
- **リスク**: 特になし。

### 3.2. 飛躍的仮説 (Leap) - 理想案
- **アプローチ**: パス指定（`--archive-dir` 等）を非推奨化し、全ての設定をメタデータ（または設定ファイル）から自動解決するように変更する。
- **メリット**: ユーザーがパスを覚える必要が完全になくなる。
- **リスク**: 実装の複雑性が増し、メタデータが壊れた際に手動復旧が難しくなる。

### 3.3. 逆説的仮説 (Paradoxical) - 革新案
- **アプローチ**: `process-diff` という「Git の差分」ベースのコマンドを廃止し、`sync-tasks` のような「ファイルの状態」ベースのコマンドに統合する。
- **メリット**: Git の状態に依存せず、CI/CD パイプラインがシンプルになる。
- **リスク**: 大規模なリファクタリングが必要。

## 4. 推奨案 (Recommendation)
**3.1. 実証的仮説** を採用する。
ADR-007 の導入初期段階であるため、まずは物理パスの整合性を整え、必要なフィルタリングオプションを追加することで、段階的な移行を支援する。
具体的には以下の変更を行う：
1. `reqs/tasks/archive/` -> `reqs/tasks/_archive/`
2. `process-diff` の走査範囲を `reqs/tasks/` ルートへの再帰探索に定義変更。
3. `--adr-id` オプションの追加。
