# 振り返りレポート (YWT): Update Lifecycle Logic Specifications

## 1. Y (やったこと)
- **作業の実施内容:**
  - `docs/specs/logic/creation_logic.md` を更新。ADR-003ベースの物理パス依存ロジックを、ADR-007ベースのメタデータID（`depends_on`）依存のDAG解析ロジックへ刷新した。
  - `docs/specs/logic/promotion_logic.md` を更新。物理ディレクトリの移動（Phase Chain）から、依存関係の解消に基づくステータス遷移（Ready判定）へプロモーションの定義を変更した。
  - `definitions.md` および ADR-007 本文を参照し、用語の一貫性（Atomic Move, Ready, Issued等）を担保した。
- **事象の観測:**
  - 既存の仕様書（ADR-003）が物理構造に強く依存しており、メタデータ駆動へ移行するためにはアルゴリズムを根本から書き換える必要があった。
  - プロモーション（フェーズ連鎖）の概念が、ADR-007では「物理的なファイルの場所」ではなく「DAG上の準備完了状態」へ昇華されていることを確認した。

## 2. W (わかったこと)
- **結果の確認:**
  - メタデータ駆動への移行により、フォルダのネストに頼らずに複雑な依存関係を表現できるようになった。
  - 「Atomic Move」を起票成功の副作用として定義することで、Git上の履歴管理とGitHub Issueの同期が論理的に整理された。

### ギャップ分析
- **理想 (To-Be):** ADR-007の「メタデータによる自律的ライフサイクル管理」に基づき、IDでタスクを特定し、`depends_on` で順序を制御する。
- **現状 (As-Is):** ADR-003ベースの仕様は、物理ディレクトリ（`archive/`, `drafts/`）の階層構造を前提としていた。
- **ギャップ:** 物理パスから論理IDへの識別子変更、およびディレクトリ移動からステータス遷移へのトリガー変更が必要。
- **要因 (Root Cause):** プロジェクトのスケールに伴う物理管理の限界（認知負荷）に対応するための、ADR-007による抜本的な設計変更。

## 3. T (次やること / 仮説立案)
- **実証的仮説:**
  - この詳細仕様に基づき `tests/unit/usecase/test_creation.py` 等のテストケースを更新することで、実装の正しさを保証できる。
- **飛躍的仮説:**
  - DAG解析ロジックを共有モジュール化（`domain/dag.py` 等）することで、タスク管理だけでなく設計ドキュメントの依存関係（ADR -> Spec -> TDD）の自動チェックにも応用できる。
- **逆説的仮説:**
  - 物理ファイルの移動（Atomic Move）は履歴追跡には有用だが、Gitの `status` 更新のみで管理を完結させ、物理移動を一切行わない（完全にフラットな1フォルダ管理）という選択肢も検討の余地がある。

### 検証アクション
- [ ] `007-T3-03-spec-infra.md` の策定時に、Atomic Move の具体的な Git 操作（`git mv`）の原子性を検証する。
- [ ] `007-T3-04-spec-cli.md` で、DAGを表示するための `ick graph` コマンドの仕様を検討する。
