# 詳細設計: メタデータ操作ロジック (ADR-002)

## 1. 目的
ADR-002（ドキュメント承認フローの自動化）において、Markdownファイルのメタデータを安全かつ正確に読み取り・更新するための技術仕様を定義する。

## 2. メタデータの構造
ドキュメントの冒頭付近に、以下の形式で記述されるリスト項目をメタデータとして扱う。

- **形式**: `^([-*]\s*\*{0,2}Key\*{0,2}:\s*)(Value)$`
- **例**:
    - `- **Status**: 提案中`
    - `* **Last Updated**: 2025-12-29`
    - `- Status: Draft`

## 3. 操作ロジック

### 3.1. 抽出 (Extraction)
既存の `create_issues.py` のロジックをベースとしつつ、マーカーの柔軟性を向上させる。
- **マーカー**: `-` または `*`
- **キー**: 太字 (`**`) または装飾なしに対応
- **スコープ**: 行頭から始まるもののみを対象とする（インデントされたリストはメタデータと見なさない）

### 3.2. 更新・置換 (Update/Replace)
以下の正規表現パターンを用いて、キーの装飾やセパレータを維持したまま、値の部分のみを置換する。

**正規表現パターン:**
```regex
^([-*]\s*\*{0,2}<KEY>\*{0,2}:\s*)(.*)$
```
- `<KEY>`: 置換対象のキー名（例: `Status`）
- **置換方法**: キャプチャグループ1 (`\1`) を保持し、マッチした行全体を `\1<NEW_VALUE>` で置き換える。

## 4. 検証済みパターン (Test Results)
T1-2 において、以下のパターンでの正常動作を確認済みである。

| 入力 (Target: Status) | 置換後 (Value: 承認済み) | 判定 | 理由 |
| :--- | :--- | :---: | :--- |
| `- **Status**: 提案中` | `- **Status**: 承認済み` | ✅ | 基本形式 |
| `* **Status**: 提案中` | `* **Status**: 承認済み` | ✅ | マーカー違い |
| `- Status: 提案中` | `- Status: 承認済み` | ✅ | 太字なし |
| `- **Status**:提案中` | `- **Status**:承認済み` | ✅ | 空白なし |
| `  - **Status**: 提案中` | (マッチしない) | ✅ | インデントあり(除外) |
| `本文内の - **Status**: ` | (マッチしない) | ✅ | 行頭以外(除外) |

## 5. 考慮事項
- **キーの重複**: 同一ファイル内に同じキーが存在する場合、全ての該当行を更新するか、最初の1行のみとするかは、実装時の要件（通常は1行目を想定）に従う。
- **文字コード**: UTF-8 を前提とする。
