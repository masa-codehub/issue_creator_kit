# 詳細設計: 検証基準（テストケース）定義 (ADR-002)

## 1. 目的
Phase 2 での実装において、`utils.py` の各関数が YAML Frontmatter を正しく扱い、ADR-002 の要件を満たすことを保証するためのテストシナリオを定義する。

## 2. `load_document` のテストケース

### 2.1. 正常系 (Success Cases)
| ID | シナリオ | 入力ファイル内容 | 期待される戻り値 (Metadata, Content) |
| :--- | :--- | :--- | :--- |
| L-1 | 標準的なFrontmatter | `---`<br>`title: Test`<br>`---`<br>`# Body` | `{'title': 'Test'}`, `"# Body"` |
| L-2 | メタデータなし | `# Body Only` | `{}`, `"# Body Only"` |
| L-3 | 複雑な型 | `---`<br>`tags: [a, b]`<br>`count: 1`<br>`---` | `{'tags': ['a', 'b'], 'count': 1}`, `""` |
| L-4 | 空のFrontmatter | `---`<br>`---`<br>`Body` | `{}`, `"Body"` |

### 2.2. 異常系 (Error Cases)
| ID | シナリオ | 入力ファイル内容 | 期待される挙動 |
| :--- | :--- | :--- | :--- |
| L-E1 | ファイル非存在 | (存在しないパス) | `FileNotFoundError` |
| L-E2 | 不正なYAML | `---`<br>`key: : value`<br>`---` | `yaml.scanner.ScannerError` (またはそれに準ずる例外) |

## 3. `save_document` / `update_metadata` のテストケース

### 3.1. 正常系 (Success Cases)
- **U-1 (新規保存)**: メタデータと本文を渡して、正しい形式のファイルが生成されること。
- **U-2 (メタデータ更新)**: 既存のキーを更新し、値が書き換わること。本文は維持されること。
- **U-3 (キー追加)**: 新しいキーを追加し、YAMLに含まれること。
- **U-4 (型維持)**: リストや数値を更新しても、YAML上で正しい型（`[ ]` や数値）として保存されること。

### 3.2. エッジケース
- **U-E1 (マルチバイト)**: 日本語を含むメタデータを保存しても文字化けしないこと（UTF-8）。
- **U-E2 (空更新)**: `updates={}` で呼び出しても、ファイルが破損しないこと。

## 4. `safe_move_file` のテストケース

### 4.1. 正常系
- **S-1**: ディレクトリ自動作成と移動が成功すること。
- **S-2**: `overwrite=True` で既存ファイルを上書き移動できること。

### 4.2. 異常系
- **S-E1**: 移動元がない場合 `FileNotFoundError`。
- **S-E2**: 移動先があり `overwrite=False` の場合 `FileExistsError`。

## 5. テスト実装方針
- `pytest` と `tmp_path` フィクスチャを使用して、実際のファイルI/Oを伴うテストを行う。
- `python-frontmatter` の仕様に依存する部分は、ライブラリのテストではなく、ラッパー関数としての振る舞い（正しくロード/ダンプできているか）を検証する。