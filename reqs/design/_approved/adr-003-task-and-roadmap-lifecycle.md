# 概要 / Summary
[ADR-003] タイトル: タスクとロードマップのライフサイクル管理と自己推進型ワークフローの定義

- **Status**: 承認済み (Updated: 2026-01-03)
- **Date**: 2026-01-01
- **Issue**: #71

## 状況 / Context
設計ドキュメント（ADR/Design Doc）の承認フローに加え、流動的な「ロードマップ」と「タスク（Draft Issue）」の管理が必要である。
特に、大規模なプロジェクトでは全タスクを一斉に起票するとバックログが管理不能になるため、フェーズごとに段階的に起票し、かつフェーズ完了時に次フェーズへ自動的に移行する「自己推進型」の仕組みが求められている。

## 決定 / Decision
設計、計画、タスクに対し、それぞれのライフサイクルを「フォルダ移動」と「自動 PR 作成」によって定義する。

### 1. 物理配置によるステータス管理
ディレクトリ構造を論理的なステータスと一致させ、Git 操作（マージ）を唯一の実行トリガーとする。

#### A. 設計ドキュメント (`reqs/design/`)
- `_inbox/`: 提案中。マージにより `_approved/` へ移動し、トラッキング Issue を起票。
- `_approved/`: 確定した SSOT。

#### B. ロードマップ (`reqs/roadmap/`)
- `_inbox/`: 策定中。マージにより `active/` へ移動。
- `active/`: 実行中。プロジェクト終了まで維持される。
- `archive/`: 完了済み。

#### C. タスク (`reqs/tasks/`)
- `drafts/`: 下書き。AI/人間により全フェーズ分が先行生成される場所。
- `_queue/`: **【自動起票トリガー】**。特定のフェーズフォルダ（例: `phase-1/`）をここへ移動しマージすることで、Issue が起票される。
- `archive/`: 起票済み。起票成功したファイルがディレクトリ構造を維持して移動される場所。

### 2. 自己推進型ワークフロー（フェーズ連鎖）
フェーズの最後となるタスクに制御用メタデータを付与し、次のフェーズを自動的にセットアップする。

- **トリガーメカニズム**:
    - タスクのメタデータに `next_phase_path: "./phase-2/"` 等の指定がある場合、ICK はそのタスクのアーカイブ完了後に次フェーズの準備を開始する。
- **自動 PR 作成 (ICK の動作)**:
    1. 新しい作業ブランチ（例: `feature/phase-chain-setup`）を作成。
    2. 指定された `drafts/` 内のフォルダを `_queue/` へ物理的に移動。
    3. コミット・プッシュし、`main` へのプルリクエストを自動作成する。

### 3. 原子的なアーカイブ (Atomic Archiving)
- **All-or-Nothing**: `_queue/` 内の全タスクが正常に起票できた場合のみ、全ファイルを `archive/` へ移動する。
- **PR ベースの整合性**: ファイル移動そのものを PR のマージ（または自動コミット）として扱う。途中でエラーが発生した場合、ファイルは `_queue/` に留まり、二重起票を防止する。

## 検討した代替案 / Alternatives Considered
- **案A: 全タスク同時起票**: バックログの混乱を招くため却下。
- **案B: ラベルによる起票制御**: 視認性が低く、Git の履歴で「起票」が物理的に記録されないため却下。

## 結果 / Consequences
### メリット
- バックログの爆発を防ぎつつ、プロジェクトの全体像（Drafts）を Git 上に保持できる。
- 「マージすれば次が始まる」という自律的な開発サイクルが実現される。
- フォルダ移動という単純な操作が、高度な自動化のインターフェースとして機能する。

### デメリット
- フォルダ階層の移動を伴うため、Git 履歴が深くなる傾向がある。

## 検証基準 / Verification Criteria
1. `_inbox/` のロードマップがマージされると `active/` へ自動移動すること。
2. `_queue/` のフォルダ内タスクが全件起票され、階層を維持して `archive/` へ移動すること。
3. `next_phase_path` を持つタスクが完了した際、次フェーズの PR が自動生成されること。
