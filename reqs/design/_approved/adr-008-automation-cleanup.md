---
id: adr-008
title: "Cleanup & Scanner Foundation"
status: Approved
date: 2026-02-06
---

# ADR-008: Cleanup & Scanner Foundation

## Context
ADR-007 移行期において、以前の自動化スクリプトや複雑な同期ロジックが負債として残っている。これらを削除し、堅牢なパイプラインのための基盤を再構築する必要がある。また、起票前に依存関係や影響範囲を視覚化したいというニーズがある。

## Decision
「引き算」によるリファクタリングを徹底し、物理状態ベースのスキャナー基盤と強力なバリデーションを導入する。

### 1. 負債の完全削除
- **自動承認の廃止**: `auto-approve-docs.yml` および `issue-kit` 内の `run-workflow`, `approve` 関連ロジックを削除。
- **書き戻しの廃止**: Markdown ファイルへの Issue 番号追記・同期ロジックを削除。

### 2. 物理状態ベースのスキャナー
- **脱 diff-tree**: Git 差分に依存せず、`reqs/` ディレクトリ内のファイルを走査して「未処理（アーカイブに未存在）」のファイルを特定するロジックへ移行する。
- **検証モード (`--dry-run`)**: 実際の起票を行う前に、スキャン結果と起票予定リストを表示する機能を実装する。
- **可視化 (`visualize`)**: 依存関係（DAG）を Mermaid 形式等で出力し、マージ前の安全性を確認可能にする。

### 3. ドメイン層によるガードレール
- **Pydantic による厳密なバリデーション**: `id` 形式、`depends_on` の自己参照禁止、循環参照チェックなどの制約を `Domain` 層（Metadata モデル）に集約する。
- **思想**: ツール全体で共通の制約を保証し、不正なデータによる起票事故を未然に防ぐ。

## Consequences
- **Positive**: システムがシンプルになり、開発サイクルが高速化する。起票前の安全確認が容易になる。
- **Negative**: 自動起票機能が一時的に（次工程まで）制限される。
