# 改善案およびプロセス定型化リスト (Improvement Candidates)

本ドキュメントは、ADR-007の実装完了および各フェーズの振り返り（Retrospectives）から得られた課題に基づき、将来的なシステムの堅牢性と開発効率を向上させるための改善案をリストアップしたものである。

## 1. ツール・技術基盤の改善案

### 1.1. 依存関係の可視化自動化 (`ick visualize`)

- **内容**: `reqs/tasks/` および `_archive/` 内のメタデータを解析し、現在のタスク依存関係（DAG）を Mermaid 形式で標準出力する機能。
- **目的**: 複雑なタスク構造を人間が手書きで管理する負担を軽減し、常に最新の「地図」を共有可能にする。

### 1.2. インフラ層のトランザクション管理

- **内容**: 「GitHub Issue起票」「ファイルメタデータ更新」「物理移動（git mv）」を一つのトランザクションとして扱い、失敗時に一括ロールバックまたは不整合通知を行う仕組み（`InfrastructureTransaction`）の導入。
- **目的**: 外部API連携とローカルファイルシステム操作の原子性を高め、不整合な状態（Issueはあるがファイルが移動していない等）を最小化する。

### 1.3. SSOT（定義ファイル）からのコード・ドキュメント自動生成

- **内容**: `definitions.md` などの構造化された定義から、Pydantic モデル、バリデーションルール、および `document_model.md` などの仕様書を自動生成する。
- **目的**: 定義・仕様・実装の3重管理を解消し、SSOT（Single Source of Truth）の信頼性を担保する。

### 1.4. バリデーションのドメイン層への集約

- **内容**: `adr-xxx` 形式のチェックや ID の一意性確認などを、CLI 層や UseCase 層から切り離し、Domain 層の `ValueObject` として共通化する。
- **目的**: システム全体で一貫した制約（不変条件）を保証し、どこで利用しても同じルールが適用されるようにする。

## 2. 作業プロセスの定型化案

### 2.1. タスク切り出しの「三層構造」テンプレート (Issue Slicing)

- **定義**:
  - **L1 (ADR)**: 設計決定の永続化と管理。
  - **L2 (Integration)**: 工程ごとの完了責任（arch, spec, tdd）。
  - **L3 (Task)**: 最小実装単位（単一関心事）。
- **目的**: エージェントごとの粒度のばらつきを抑え、依存グラフ（DAG）の構造を最適化する。

### 2.2. 三段階事前レポートプロトコル (Pre-Implementation)

- **手順**:
  1. **Reconnaissance (偵察)**: `scouting-facts` による事実収集。
  2. **Analysis (分析)**: 現状と理想のギャップ、リスクの特定。
  3. **Goal Definition (目標)**: DoD（完了定義）の明文化。
- **目的**: 実装着手前の手戻りを防ぎ、設計意図との整合性を確実に担保する。

### 2.3. インターフェース先行実装プロトコル (Interface-First TDD)

- **手順**:
  1. `domain/interfaces.py` で `Protocol` を定義。
  2. 依存層を Mock した UseCase のテストを作成。
  3. 最後に Adapter (具象実装) を作成する。
- **目的**: 外部依存（API/DB等）からロジックを切り離し、テストの容易性と実装の交換可能性を最大化する。

### 2.4. 確定・伝播・アーカイブシーケンス (Commit Protocol)

- **手順**: `Issue案マージ` → `起票成功` → `GitHub Issue番号によるファイル名リネーム` → `_archive移動`。
- **目的**: Git上の物理的なファイル状態（場所と名前）を見るだけで、タスクのライフサイクル状態を誰でも即座に判別可能にする。
