name: CI

on:
  pull_request:
    branches:
      - main

permissions:
  issues: write
  contents: write

jobs:
  build:
    runs-on: self-hosted
    env:
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    steps:
      - uses: actions/checkout@v4

      # [環境依存のセットアップ]
      # 実行環境に Python 3.13 がない場合は、以下のステップを追加してください。
      # - name: Set up Python
      #   uses: actions/setup-python@v5
      #   with:
      #     python-version: '3.13.3'
      #     cache: 'pip'
      #     cache-dependency-path: '**/pyproject.toml'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          # プロジェクトの依存関係（pre-commit を含む）をインストール
          python -m pip install -e .[test,dev]

      - name: Run checks with pre-commit
        run: |
          # pre-commit を直接呼び出し、Linter (Ruff), Formatter (Ruff), Type Check (Mypy), Test (Pytest) を一括実行します。
          # 設定は .pre-commit-config.yaml に基づき、ローカル開発時と同じチェック内容を保証します。
          python -m pre_commit run --all-files

      # 注: カバレッジレポートのアップロードが必要な場合は、
      # pre-commit の pytest フックに引数を渡すか、個別の pytest ステップを維持してください。
